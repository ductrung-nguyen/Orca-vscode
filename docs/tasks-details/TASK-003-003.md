# TASK-003-003: Add Configuration Settings

**Phase**: Phase 1 - Output File Persistence  
**Priority**: P0  
**Estimated Effort**: 1 hour  
**Assigned To**: TBD  
**Status**: Not Started

---

## Overview

Add user-configurable settings to control output file behavior, syntax highlighting, and dashboard features. This provides users with control over the new functionality while maintaining sensible defaults.

---

## Dependencies

**Blocked By**: None  
**Blocks**: 
- TASK-003-002 (Integration needs config values)
- TASK-003-004 (Real-time writing depends on config)

---

## Objectives

1. Add new configuration settings to `package.json`
2. Define appropriate default values
3. Provide clear descriptions for users
4. Ensure settings are accessible in code

---

## Technical Specifications

### File to Modify
`package.json`

### Configuration Schema

Add to `contributes.configuration.properties`:

```json
{
  "contributes": {
    "configuration": {
      "title": "ORCA",
      "properties": {
        "orca.saveOutputToFile": {
          "type": "boolean",
          "default": true,
          "description": "Automatically save ORCA execution output to .out files in the same directory as the input file."
        },
        "orca.dashboardAutoOpen": {
          "type": "boolean",
          "default": false,
          "description": "Automatically open the results dashboard after an ORCA job completes successfully."
        },
        "orca.outputSyntaxHighlighting": {
          "type": "boolean",
          "default": true,
          "description": "Enable syntax highlighting for ORCA .out files. Disable for very large files if performance issues occur."
        },
        "orca.maxSyntaxFileSize": {
          "type": "number",
          "default": 5,
          "minimum": 0,
          "maximum": 100,
          "description": "Maximum file size (in MB) for syntax highlighting. Files larger than this will be displayed as plain text. Set to 0 to disable the limit."
        },
        "orca.outputFileTimestamp": {
          "type": "boolean",
          "default": false,
          "description": "Add timestamp to output filenames (e.g., water_opt_20251222_143052.out) instead of overwriting existing .out files. [Not implemented in v0.3.0]"
        }
      }
    }
  }
}
```

### Settings Access Pattern

In TypeScript code:
```typescript
const config = vscode.workspace.getConfiguration('orca');
const saveToFile = config.get<boolean>('saveOutputToFile', true);
const autoOpen = config.get<boolean>('dashboardAutoOpen', false);
const enableSyntax = config.get<boolean>('outputSyntaxHighlighting', true);
const maxSize = config.get<number>('maxSyntaxFileSize', 5);
```

---

## Implementation Steps

### Step 1: Update package.json (30 min)
1. Locate `contributes.configuration` section
2. Add new properties with proper indentation
3. Validate JSON syntax
4. Ensure no duplicate keys

### Step 2: Test Configuration UI (15 min)
1. Reload VS Code extension development host
2. Open Settings (Ctrl+,)
3. Search for "ORCA"
4. Verify all new settings appear
5. Test changing values

### Step 3: Verify Code Access (15 min)
1. Add test code to read settings
2. Verify defaults work
3. Change settings and verify values update
4. Test with workspace vs. user settings

---

## Acceptance Criteria

### Functional Requirements
- ✅ All settings appear in VS Code Settings UI
- ✅ Default values are sensible
- ✅ Descriptions are clear and helpful
- ✅ Settings accessible via `getConfiguration()`
- ✅ Settings work in both user and workspace scopes

### Code Quality
- ✅ Valid JSON (no syntax errors)
- ✅ Consistent naming convention (`orca.*`)
- ✅ Proper types and constraints
- ✅ No duplicate configuration keys

### User Experience
- ✅ Settings are discoverable (search "output")
- ✅ Descriptions explain what setting does
- ✅ Defaults don't surprise users
- ✅ Advanced settings clearly marked

---

## Testing Instructions

### Manual Testing

1. **Settings UI Test**:
   - Press `Ctrl+,` (Cmd+, on Mac)
   - Search for "ORCA"
   - Verify 5 new settings appear
   - Toggle boolean settings
   - Adjust numeric setting
   - Verify UI updates correctly

2. **Code Access Test**:
   ```typescript
   const config = vscode.workspace.getConfiguration('orca');
   console.log('Save to file:', config.get('saveOutputToFile'));
   console.log('Auto open:', config.get('dashboardAutoOpen'));
   console.log('Syntax highlight:', config.get('outputSyntaxHighlighting'));
   console.log('Max file size:', config.get('maxSyntaxFileSize'));
   ```

3. **Default Values Test**:
   - Don't change any settings
   - Run code above
   - Verify defaults match package.json

4. **Workspace vs. User Test**:
   - Set value in user settings
   - Override in workspace settings
   - Verify workspace value takes precedence

---

## Integration Points

### With OutputFileWriter (TASK-003-001)
```typescript
const config = vscode.workspace.getConfiguration('orca');
const saveEnabled = config.get<boolean>('saveOutputToFile', true);
const writer = new OutputFileWriter(inputPath, saveEnabled);
```

### With Dashboard (TASK-003-021)
```typescript
const autoOpen = config.get<boolean>('dashboardAutoOpen', false);
if (autoOpen && jobSucceeded) {
  DashboardPanel.createOrShow(extensionUri, outputPath);
}
```

### With Syntax Highlighting (TASK-003-007)
- `outputSyntaxHighlighting`: Enable/disable grammar
- `maxSyntaxFileSize`: Size limit for tokenization

---

## User Documentation

Update README.md with settings documentation:

```markdown
## Configuration

The extension provides the following settings:

- **orca.saveOutputToFile** (default: `true`): Automatically save ORCA output to `.out` files
- **orca.dashboardAutoOpen** (default: `false`): Open results dashboard after job completion
- **orca.outputSyntaxHighlighting** (default: `true`): Enable syntax highlighting for `.out` files
- **orca.maxSyntaxFileSize** (default: `5`): Maximum file size (MB) for syntax highlighting

Access settings via File > Preferences > Settings and search for "ORCA".
```

---

## Default Value Rationale

| Setting | Default | Rationale |
|---------|---------|-----------|
| `saveOutputToFile` | `true` | Core feature; most users want persistence |
| `dashboardAutoOpen` | `false` | Avoid disruption; user can open manually |
| `outputSyntaxHighlighting` | `true` | Enhances readability; core feature |
| `maxSyntaxFileSize` | `5` MB | Balance performance vs. functionality |
| `outputFileTimestamp` | `false` | Not implemented in v0.3.0; future feature |

---

## Edge Cases

- **Negative maxSyntaxFileSize**: Validation prevents (minimum: 0)
- **Very large maxSyntaxFileSize**: User's choice; may impact performance
- **Settings.json syntax error**: VS Code handles; extension gets defaults

---

## Risks & Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| User disables critical feature | Low | Low | Clear descriptions; sensible defaults |
| Settings not updating in real-time | Medium | Low | Use config change event listeners in future |
| Conflicting workspace/user settings | Low | Low | VS Code handles precedence automatically |

---

## Future Enhancements

Settings for future versions:
- `orca.outputFileTimestamp`: Timestamp filenames (deferred to v0.4.0)
- `orca.dashboardLayout`: Customize dashboard sections
- `orca.parserExtensions`: Enable custom parsing plugins

---

## Completion Checklist

- [ ] All settings added to package.json
- [ ] JSON validates successfully
- [ ] Settings appear in UI
- [ ] Code can read all settings
- [ ] Defaults work correctly
- [ ] Documentation updated
- [ ] Tested in both user and workspace scopes
- [ ] Ready for use in TASK-003-002

---

**Notes**:
- Keep settings simple and focused
- Avoid feature creep (advanced settings for future)
- Test with VS Code reload after changes
